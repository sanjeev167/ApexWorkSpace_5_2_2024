package com.nus.fileupload.repo;

import java.util.Date;
import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import com.nus.fileupload.entities.ProjectMonthlyResourceAllocation;

/**
 * @Author:SanjeevKumar<br>
 * @Date:24-Jan-2025<br>
 * @Time:10:47:47 pm<br>
 * @Objective: <br>
 */
@Repository
public interface MonthlyResourceAllocationRepo extends JpaRepository<ProjectMonthlyResourceAllocation, Integer>{

	@Query(value = "SELECT * FROM project_monthly_resource_allocation WHERE file_upload_date =?1", nativeQuery = true)
	List<ProjectMonthlyResourceAllocation> getAllByMonthAndYear(Date fileUploadDate);

	@Query(value = "SELECT DISTINCT emp_code, MAX(allocation_percentage) FROM project_monthly_resource_allocation "
			                             + "WHERE project_code_id =?1"
			                             + " AND allocation_month >=?2 AND allocation_month <=?3 "
			+ " AND allocation_year >=?4 AND allocation_year <=?4 AND allocation_percentage > 0", nativeQuery = true)	
	List<ProjectMonthlyResourceAllocation> getMonthlyDistinctResourceAllocationBetweenMonths(int projectCodeId, 
			                                                              int fMonth,int tMonth, int fYear, int tYear);
	
	@Query(value = "SELECT * FROM project_monthly_resource_allocation WHERE "
																		+ " project_code_id =?1"
																		+ " AND allocation_month =?2"
																		+ " AND allocation_year =?3", nativeQuery = true)	
	List<ProjectMonthlyResourceAllocation> getDistinctResourceAllocationForCurrentMonth(int projectCodeId,
			                                                                 int currentMonthNo, int currentMonthYear);

	@Query(value = "SELECT * FROM project_monthly_resource_allocation WHERE "
			+ " project_code_id =?1"
			+ " AND allocation_month =?2"
			+ " AND allocation_year =?3"
			+ " AND emp_status = 'Active' "
			+ " AND billing_status = 'Billable'", nativeQuery = true)	

	List<ProjectMonthlyResourceAllocation> getResourceAllocationForSpan_1AndSpan_2Calculation(int projectCodeId,
			int fMonthNo, int tMonthNo, int fYear, int tYear);

}

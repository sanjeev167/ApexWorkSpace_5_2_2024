package com.nus.pvt.reports.service;

import java.text.SimpleDateFormat;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.nus.base.service.UserLoginBaseService;
import com.nus.pvt.admin.entities.AssignProjectToPm;
import com.nus.pvt.admin.repo.AssignProjectToPmRepo;
import com.nus.pvt.reports.model.PmProjectReportModel;
import com.nus.pvt.reports.model.ProjectDetails;
import com.nus.util.DateTimeFormatUtil;

/**
 * @Author: SanjeevKumar<br>
 * @Date: 08-Feb-2025<br>
 * @Time: 4:01:12 pm<br>
 * @Objective: <br>
 */
@Service
public class PmAssignedProjectReportServiceImpl extends UserLoginBaseService
		implements PmAssignedProjectReportService {

	@Autowired
	AssignProjectToPmRepo assignProjectToPmRepo;

	@Override
	public PmProjectReportModel getPmReports(String fMonthYr, String tMonthYr) throws Exception {
		
		PmProjectReportModel pMProjectReportModel = null;
		try {
		List<AssignProjectToPm> assignProjectToPmList = assignProjectToPmRepo.findByPm(getCurrentLoginUserId(),activeC);		
		
		if(assignProjectToPmList.size()!=0) {
			pMProjectReportModel= new PmProjectReportModel();
			pMProjectReportModel.setPm(assignProjectToPmList.get(0).getApexUser3().getName());
			pMProjectReportModel.setEmpGrade(assignProjectToPmList.get(0).getApexUser3().getUserGrade().getUserGrade());
			pMProjectReportModel.setfMonthYr(DateTimeFormatUtil.getDateInMMYYYY(fMonthYr));			  
			pMProjectReportModel.settMonthYr(DateTimeFormatUtil.getDateInMMYYYY(tMonthYr));			
			pMProjectReportModel.setReportFor(DateTimeFormatUtil.monthsBetweenDates(fMonthYr, tMonthYr)+" - Month");
		}
		
		ProjectDetails projectDetails;
		for (AssignProjectToPm assignProjectToPm : assignProjectToPmList) {
			projectDetails = new ProjectDetails();
			projectDetails.setAssignedOn(new SimpleDateFormat("dd-MM-yyyy").format(assignProjectToPm.getAssignedOn()));
			if(assignProjectToPm.getReleasedOn()!=null)
			   projectDetails.setReleasedOn(new SimpleDateFormat("dd-MM-yyyy").format(assignProjectToPm.getReleasedOn()));
			if(assignProjectToPm.getProjectClosedOn()!=null)
			   projectDetails.setClosedOn(new SimpleDateFormat("dd-MM-yyyy").format(assignProjectToPm.getProjectClosedOn()));
			
			projectDetails.setClientAccount(assignProjectToPm.getClientAccountMstr().getClientAccount());
			projectDetails.setProjectVertical(assignProjectToPm.getProjectVerticalMstr().getVerticalName());
			projectDetails.setProjectCode(assignProjectToPm.getProjectCodeMstr().getProjectCode());
			projectDetails.setProjectName(assignProjectToPm.getProjectCodeMstr().getProjectName());
			projectDetails.setProjectType(assignProjectToPm.getProjectTypeMstr().getProjectType());
			
			pMProjectReportModel.getProjectDetailReportList().add(projectDetails);			
		}
		}catch(Exception ex) {
			throw ex;
		}
		return pMProjectReportModel;
	}

}
